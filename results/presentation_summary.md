# LoL視界スコア指標による勝率予測精度向上の試み

**最終更新**: 2026-01-08
**分析完了日**: 2026-01-07

## 1. 研究目的

### 背景
- League of Legendsにおいて「視界（Vision）」は勝敗を左右する重要な戦術要素
- 先行研究（WARDS論文）では視界スコアが勝率予測に寄与することを示唆
- Riot公式の`visionScore`は試合終了後にのみ取得可能で、リアルタイム予測には使用不可

### 目的
**リプレイ映像からward座標を抽出し、独自の視界スコア指標を作成することで、勝率予測精度の向上を目指す**

### 仮説
「wardの配置座標（どこに置いたか）」を特徴量として組み込むことで、単純なward設置数よりも高い予測精度が得られる

---

## 2. 手法

### 2.1 データ収集パイプライン

```
Riot API → matchId取得 → .roflダウンロード → リプレイ再生 → ミニマップキャプチャ
```

- **対象**: JPサーバー、Diamond帯、パッチ25.S1.2
- **収集試合数**: 123試合
- **有効試合数**: 92試合（20分以上継続した試合）
- **Blue勝利**: 45試合（48.9%）、**Red勝利**: 47試合（51.1%）

### 2.2 Ward検出

| 項目 | 内容 |
|------|------|
| モデル | YOLOv8n |
| 学習データ | 手動アノテーション 1,500枚 |
| クラス | stealth_ward, stealth_ward_enemy, control_ward, control_ward_enemy |
| 検出後処理 | 時系列クラスタリング + Riot APIタイムラインとのマッチング |

### 2.3 特徴量設計

| 特徴量セット | 内容 | 次元数 |
|--------------|------|--------|
| baseline | gold, kills, dragons, towers, wards_placed 等 | 20 |
| +Riot visionScore | visionScorePerMinuteからの推定値 | +3 |
| +wardグリッド | 32x32グリッドへのward配置累積統計量 | +6 |
| **+戦術スコア** | **ヒートマップ重要度ベースのward評価** | **+6** |

### 2.4 戦術スコアの設計（新規提案）

#### ヒートマップ重要度マップ
- ward座標グリッド(32x32)と勝敗のロジスティック回帰から抽出
- 各セルに「勝敗への寄与度」を割り当て
- 正の値=Blue有利、負の値=Red有利

#### スコアリングルール

| スコア | 条件（重要度の絶対値） |
|--------|------------------------|
| 2点 | >= 0.03（強い相関） |
| 1点 | 0.01 ~ 0.03（弱い相関） |
| 0点 | < 0.01（相関なし） |

- **設置スコア**: 自チームに有利な位置にwardを置くと獲得
- **破壊スコア**: 敵チームに有利な位置の敵wardを破壊すると獲得

### 2.5 評価設定

- **有効試合数**: 92試合（20分以上継続）
- **評価時点**: 10分、20分
- **評価手法**: Leave-One-Out Cross Validation
- **モデル**: ロジスティック回帰

---

## 3. 実験結果

### 3.1 モデル性能比較

#### 10分時点

| モデル | Accuracy | AUC | LogLoss | 精度向上 |
|--------|----------|-----|---------|----------|
| baseline | 59.78% | 0.648 | 0.666 | - |
| +Riot visionScore | 68.48% | 0.710 | 0.636 | +8.70 pt |
| +wardグリッド | 59.78% | 0.648 | 0.675 | +0.00 pt |
| **+戦術スコア** | **77.17%** | **0.826** | **0.519** | **+17.39 pt** |

#### 20分時点

| モデル | Accuracy | AUC | LogLoss | 精度向上 |
|--------|----------|-----|---------|----------|
| baseline | 80.43% | 0.901 | 0.401 | - |
| +Riot visionScore | 84.78% | 0.907 | 0.386 | +4.35 pt |
| +wardグリッド | 80.43% | 0.884 | 0.420 | +0.00 pt |
| **+戦術スコア** | **88.04%** | **0.945** | **0.320** | **+7.61 pt** |

### 3.2 視界スコアの相対貢献度

「完璧な予測（100%）からの距離をどれだけ縮めたか」を示す指標:

| モデル | 10分 相対貢献度 | 20分 相対貢献度 |
|--------|-----------------|-----------------|
| +Riot visionScore | 21.62% | 22.22% |
| +wardグリッド | 0.00% | 0.00% |
| **+戦術スコア** | **43.24%** | **38.89%** |

### 3.3 特徴量重要度（10分時点、戦術スコアモデル）

| 順位 | 特徴量 | 重要度 | カテゴリ |
|------|--------|--------|----------|
| 1 | red_placement_score | 0.676 | 戦術スコア |
| 2 | blue_placement_score | 0.366 | 戦術スコア |
| 3 | red_dragons | 0.276 | オブジェクト |
| 4 | red_total_cs | 0.261 | CS |
| 5 | blue_deny_score | 0.259 | 戦術スコア |
| 6 | blue_dragons | 0.245 | オブジェクト |
| 7 | kill_diff | 0.182 | キル |

### 3.4 特徴量重要度（20分時点、戦術スコアモデル）

| 順位 | 特徴量 | 重要度 | カテゴリ |
|------|--------|--------|----------|
| 1 | red_placement_score | 0.592 | 戦術スコア |
| 2 | blue_placement_score | 0.412 | 戦術スコア |
| 3 | blue_avg_level | 0.295 | レベル |
| 4 | red_avg_level | 0.282 | レベル |
| 5 | red_total_gold | 0.246 | ゴールド |

### 3.5 主要な発見

1. **戦術スコアは最も高い予測精度を達成**
   - 10分時点: +17.39 pt（59.78% → 77.17%）
   - 20分時点: +7.61 pt（80.43% → 88.04%）

2. **Riot visionScoreを上回る性能**
   - 10分時点で約2倍の精度向上効果（+8.70 pt vs +17.39 pt）

3. **単純なwardグリッド特徴量は効果なし**
   - 位置の戦術的価値を考慮していないため、予測精度に寄与しない
   - むしろLogLossが悪化（0.666 → 0.675）

4. **序盤（10分時点）ほど戦術スコアの効果が顕著**
   - ゴールド差が小さい序盤では視界の質が重要
   - 20分以降は経済指標（レベル、ゴールド）が支配的

---

## 4. 考察

### 4.1 なぜ戦術スコアは効果的だったか

| 要因 | 説明 |
|------|------|
| 位置の価値を定量化 | 全てのwardを同等に扱わず、戦術的に重要な位置を高評価 |
| 勝敗との相関を学習 | ヒートマップから「勝利に寄与するward配置」を学習済み |
| 低次元で効率的 | 6特徴量のみで高い予測力を実現 |
| 攻防両面を評価 | 設置スコア（攻撃）と破壊スコア（防御）で包括的に評価 |

### 4.2 なぜwardグリッド特徴量は効かなかったか

| 要因 | 説明 |
|------|------|
| 情報の冗長性 | baselineに`wards_placed`（設置数）が既に含まれる |
| 文脈の欠落 | 「どこに」だけでは不十分。戦術的価値を考慮していない |
| 次元の呪い | 高次元特徴量は92試合では学習困難 |
| ノイズの増加 | 無関係な位置情報がノイズとなりLogLossが悪化（0.666→0.675） |

### 4.3 Riot visionScoreとの比較

| 観点 | Riot visionScore | 戦術スコア |
|------|------------------|------------|
| 計算方法 | Riot社の非公開アルゴリズム | ヒートマップ重要度による評価 |
| 予測精度向上（10分） | +8.70 pt | **+17.39 pt** |
| 予測精度向上（20分） | +4.35 pt | **+7.61 pt** |
| AUC向上（10分） | +0.062 | **+0.178** |
| AUC向上（20分） | +0.006 | **+0.044** |
| 利点 | 公式指標 | **位置の戦術的価値を反映** |

### 4.4 時間帯別の効果

| 時点 | 戦術スコア効果 | 理由 |
|------|----------------|------|
| 10分 | +17.39 pt | ゴールド差が小さく、視界の質が重要 |
| 20分 | +7.61 pt | 経済差が拡大し、従来指標が支配的 |

**結論**: 序盤ほど視界スコアの効果が大きい

---

## 5. 成果物

| 成果物 | 説明 | パス |
|--------|------|------|
| データパイプライン | リプレイ収集〜ward座標抽出の自動化 | `notebooks/01-06` |
| YOLOv8モデル | ward検出モデル | `models/best.pt` |
| 戦術スコア計算 | ヒートマップ重要度ベーススコアリング | `autoLeague/scoring/tactical_scorer.py` |
| 予測モデル | 勝敗予測ロジスティック回帰 | `autoLeague/prediction/` |
| データセット | 92試合分の特徴量・ラベル | `data/prediction_dataset.npz` |
| 学習済みモデル | 各時点・各モデルタイプ | `models/*_10min.joblib`, `models/*_20min.joblib` |

---

## 6. 結論

### 仮説の検証結果

> 「ward座標を特徴量として組み込むことで予測精度が向上する」

**採択: 戦術スコア化により+17.39 pt（10分時点）の精度向上を達成**

ただし、単純な座標情報ではなく、ヒートマップ重要度で重み付けした「戦術的価値」として定量化することが必要でした。

### 最終モデル性能

| 評価時点 | 最良モデル | Accuracy | AUC |
|----------|------------|----------|-----|
| 10分 | baseline_tactical | **77.17%** | **0.826** |
| 20分 | baseline_tactical | **88.04%** | **0.945** |

### 得られた知見

1. ward座標の「生データ」は勝敗予測に直接寄与しない
2. **wardの戦術的価値（どこに置くか）を定量化することで、Riot visionScoreを約2倍上回る精度向上を実現**
3. ヒートマップを用いた「勝敗に寄与するward配置」の学習が有効
4. 序盤（10分時点）ほど視界スコアの効果が大きい

### 制約事項

- サンプルサイズ: 92試合は統計的に十分とは言えない
- visionScore推定値: 途中時点のRiot visionScoreは推定値であり正確ではない
- サーバー・ティア依存: JPサーバー・Diamond帯のみで検証
- パッチ依存: パッチ25.S1.2のメタに依存

---

## 7. 今後の展望

| アプローチ | 内容 |
|------------|------|
| データ拡張 | 92試合→数百試合での検証 |
| 時間帯別最適化 | 5分刻みのヒートマップを活用した精緻化 |
| 破壊スコアの強化 | ward破壊の戦術的価値をより精密に評価 |
| チャンピオン座標統合 | 視界が「何を捉えたか」を評価可能に |
| 他モデルの検討 | LightGBM、XGBoostなどの試行 |
| 他サーバー・ティアでの検証 | 汎用性の確認 |

---

## 参考資料

| ファイル | 説明 |
|----------|------|
| `results/phase6_analysis_report.md` | 詳細な分析レポート |
| `results/tactical_score_evaluation.json` | 戦術スコア評価結果（JSON） |
| `results/model_comparison.json` | モデル比較結果（JSON） |
| `results/tactical_score_summary.md` | 戦術スコアサマリー |
| `results/model_comparison.png` | モデル比較グラフ |
| `results/feature_importance_10min.png` | 特徴量重要度（10分時点） |
| `results/feature_importance_20min.png` | 特徴量重要度（20分時点） |
| `heatmaps/importance_grid.png` | ヒートマップ可視化 |
