# LoL視界スコア指標による勝率予測精度向上の試み

## 1. 研究目的

### 背景
- League of Legendsにおいて「視界（Vision）」は勝敗を左右する重要な戦術要素
- 先行研究（WARDS論文）では視界スコアが勝率予測に寄与することを示唆
- Riot公式の`visionScore`は試合終了後にのみ取得可能で、リアルタイム予測には使用不可

### 目的
**リプレイ映像からward座標を抽出し、独自の視界スコア指標を作成することで、勝率予測精度の向上を目指す**

### 仮説
「wardの配置座標（どこに置いたか）」を特徴量として組み込むことで、単純なward設置数よりも高い予測精度が得られる

---

## 2. 手法

### 2.1 データ収集パイプライン

```
Riot API → matchId取得 → .roflダウンロード → リプレイ再生 → ミニマップキャプチャ
```

- **対象**: JPサーバー、Diamond帯、パッチ25.S1.2
- **収集試合数**: 123試合

### 2.2 Ward検出

| 項目 | 内容 |
|------|------|
| モデル | YOLOv8n |
| 学習データ | 手動アノテーション 1,500枚 |
| クラス | stealth_ward, stealth_ward_enemy, control_ward, control_ward_enemy |
| 検出後処理 | 時系列クラスタリング + Riot APIタイムラインとのマッチング |

### 2.3 特徴量設計

| 特徴量セット | 内容 | 次元数 |
|--------------|------|--------|
| baseline | gold, kills, dragons, towers, wards_placed 等 | 20 |
| +Riot visionScore | visionScorePerMinuteからの推定値 | +3 |
| +wardグリッド | 32x32グリッドへのward配置累積（PCA圧縮） | +6 |

### 2.4 評価設定

- **有効試合数**: 92試合（20分以上継続）
- **評価時点**: 10分、20分
- **評価手法**: Leave-One-Out Cross Validation
- **モデル**: ロジスティック回帰

---

## 3. 実験結果

### 3.1 モデル性能比較

#### 10分時点

| モデル | Accuracy | AUC | 精度向上 |
|--------|----------|-----|----------|
| baseline | 59.8% | 0.648 | - |
| +Riot visionScore | **68.5%** | **0.710** | **+8.7%** |
| +wardグリッド | 59.8% | 0.648 | ±0.0% |

#### 20分時点

| モデル | Accuracy | AUC | 精度向上 |
|--------|----------|-----|----------|
| baseline | 80.4% | 0.901 | - |
| +Riot visionScore | **84.8%** | **0.907** | **+4.4%** |
| +wardグリッド | 80.4% | 0.884 | ±0.0% |

### 3.2 主要な発見

1. **Riot visionScoreは予測精度に寄与する**（10分時点で+8.7%）
2. **ward座標のグリッド特徴量は寄与しない**（貢献度ゼロ）
3. 時間経過に伴い予測精度は向上（59.8% → 80.4%）

---

## 4. 考察

### 4.1 なぜwardグリッド特徴量は効かなかったか

| 要因 | 説明 |
|------|------|
| 情報の冗長性 | baselineに`wards_placed`（設置数）が既に含まれる |
| 文脈の欠落 | 「どこに」だけでは不十分。「いつ・なぜ」が欠けている |
| 次元の呪い | 32x32=1024次元は92試合では学習困難 |
| 戦術的価値の未反映 | 「重要な視界」と「無意味な視界」を区別できていない |

### 4.2 Riot visionScoreとの違い

| 観点 | Riot visionScore | 自作wardグリッド |
|------|------------------|------------------|
| 情報源 | ward設置・破壊・視界提供時間 | ward座標のみ |
| 次元 | 低次元（チームごとに1値） | 高次元（グリッド） |
| 戦術的意味 | 視界の「質」を反映 | 視界の「位置」のみ |

### 4.3 先行研究との関連

WARDS論文が「スコア化」を行っていた理由が理解できた：
- ward座標の生データは予測に直接使えない
- 戦術的文脈（オブジェクト争い、ガンク警戒等）との紐付けが必要
- 「視界の価値」を定量化するドメイン知識が不可欠

---

## 5. 成果物

| 成果物 | 説明 |
|--------|------|
| データパイプライン | リプレイ収集〜ward座標抽出の自動化 |
| YOLOv8モデル | ward検出モデル（models/best.pt） |
| データセット | 92試合分の特徴量（data/prediction_dataset.npz） |
| 分析コード | notebooks/07, 08 |

---

## 6. 結論

### 仮説の検証結果

> 「ward座標を特徴量として組み込むことで予測精度が向上する」

**→ 棄却：単純なグリッド化では効果なし**

### 得られた知見

1. ward座標の「生データ」は勝敗予測に直接寄与しない
2. Riot visionScoreは有効な指標である（+4〜9%の精度向上）
3. 視界情報を活用するには「スコア化」（戦術的価値の定量化）が必要

---

## 7. 今後の展望

| アプローチ | 内容 |
|------------|------|
| スコア化 | 重要エリア（リバー、オブジェクト周辺）の視界時間を数値化 |
| 時系列分析 | 「勝敗が決まる瞬間」の視界状況に注目 |
| チャンピオン座標追加 | 視界が「何を捉えたか」を評価可能に |
| 先行研究の精読 | WARDS論文のスコア設計を詳細に分析 |

---

## 参考

- 実験結果JSON: `results/model_comparison.json`
- 比較グラフ: `results/model_comparison.png`
- 特徴量重要度: `results/feature_importance_*.png`
