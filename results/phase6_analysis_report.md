# Phase 6: 勝敗予測モデル分析レポート

**分析日**: 2026-01-07
**評価手法**: Leave-One-Out Cross Validation (LOO-CV)
**モデル**: ロジスティック回帰

---

## 1. データセット概要

### 1.1 基本情報

| 項目 | 値 |
|------|-----|
| 有効試合数 | 92試合 |
| Blue勝利 | 45試合 (48.9%) |
| Red勝利 | 47試合 (51.1%) |
| 評価時点 | 10分、20分 |

### 1.2 データソース

- **Timeline API**: `/lol/match/v5/matches/{matchId}/timeline`
- **Match API**: `/lol/match/v5/matches/{matchId}`
- **ward座標**: YOLOv8検出 + Riot APIタイムラインマッチング
- **サーバー**: JPサーバー、Diamond帯
- **パッチ**: 25.S1.2

---

## 2. 特徴量定義

### 2.1 ベースライン特徴量（20個）

| カテゴリ | 特徴量名 | 説明 |
|----------|----------|------|
| **ゴールド** | blue_total_gold | Blueチーム総ゴールド |
| | red_total_gold | Redチーム総ゴールド |
| | gold_diff | ゴールド差（Blue - Red） |
| **経験値** | blue_total_xp | Blueチーム総経験値 |
| | red_total_xp | Redチーム総経験値 |
| **レベル** | blue_avg_level | Blueチーム平均レベル |
| | red_avg_level | Redチーム平均レベル |
| **CS** | blue_total_cs | Blueチーム総CS |
| | red_total_cs | Redチーム総CS |
| **キル** | blue_kills | Blueチーム総キル数 |
| | red_kills | Redチーム総キル数 |
| | kill_diff | キル差（Blue - Red） |
| **オブジェクト** | blue_dragons | Blueチーム獲得ドラゴン数 |
| | red_dragons | Redチーム獲得ドラゴン数 |
| | blue_heralds | Blueチーム獲得ヘラルド数 |
| | red_heralds | Redチーム獲得ヘラルド数 |
| | blue_towers | Blueチーム破壊タワー数 |
| | red_towers | Redチーム破壊タワー数 |
| **ワード** | blue_wards_placed | Blueチームward設置数 |
| | red_wards_placed | Redチームward設置数 |

### 2.2 Riot visionScore特徴量（+3個）

| 特徴量名 | 説明 |
|----------|------|
| blue_vision_score_est | Blueチーム推定visionScore（visionScorePerMinute × 経過分） |
| red_vision_score_est | Redチーム推定visionScore |
| vision_score_diff | visionScore差（Blue - Red） |

**注意**: Riot APIの`visionScore`は試合終了時のみ取得可能なため、`visionScorePerMinute`から途中時点の値を推定しています。

### 2.3 wardグリッド特徴量（+6個）

| 特徴量名 | 説明 |
|----------|------|
| grid_blue_total | Blueチームward設置グリッドセル合計 |
| grid_red_total | Redチームward設置グリッドセル合計 |
| grid_blue_mean | Blueチームward設置グリッドセル平均 |
| grid_red_mean | Redチームward設置グリッドセル平均 |
| grid_blue_max | Blueチームward設置グリッドセル最大 |
| grid_red_max | Redチームward設置グリッドセル最大 |

**グリッド仕様**: 32×32グリッド、ミニマップ座標を分割

### 2.4 戦術スコア特徴量（+6個）

| 特徴量名 | 説明 |
|----------|------|
| blue_placement_score | Blueチーム設置スコア累積 |
| red_placement_score | Redチーム設置スコア累積 |
| blue_deny_score | Blueチーム破壊スコア累積 |
| red_deny_score | Redチーム破壊スコア累積 |
| placement_score_diff | 設置スコア差（Blue - Red） |
| deny_score_diff | 破壊スコア差（Blue - Red） |

**スコアリングルール**:
- ヒートマップ重要度マップ（ロジスティック回帰で学習）から各グリッドセルの「勝敗への寄与度」を取得
- 重要度の絶対値に基づきスコアを付与

| 重要度の絶対値 | スコア |
|---------------|--------|
| >= 0.03 | 2点 |
| 0.01 ~ 0.03 | 1点 |
| < 0.01 | 0点 |

---

## 3. 比較モデル

| モデル名 | 説明 | 特徴量数 |
|----------|------|----------|
| baseline | 標準特徴量のみ | 20 |
| baseline_riot | ベースライン + Riot visionScore推定値 | 23 |
| baseline_grid | ベースライン + wardグリッド統計量 | 26 |
| baseline_tactical | ベースライン + 戦術スコア | 26 |

---

## 4. 評価結果

### 4.1 10分時点

#### モデル性能比較

| モデル | Accuracy | AUC | LogLoss | 特徴量数 |
|--------|----------|-----|---------|----------|
| baseline | 59.78% | 0.648 | 0.666 | 20 |
| baseline_riot | 68.48% | 0.710 | 0.636 | 23 |
| baseline_grid | 59.78% | 0.648 | 0.675 | 26 |
| **baseline_tactical** | **77.17%** | **0.826** | **0.519** | 26 |

#### ベースラインからの改善度

| モデル | Accuracy改善 | AUC改善 | 相対貢献度 |
|--------|-------------|---------|------------|
| baseline_riot | +8.70 pt | +0.062 | 21.62% |
| baseline_grid | +0.00 pt | +0.000 | 0.00% |
| **baseline_tactical** | **+17.39 pt** | **+0.178** | **43.24%** |

#### 特徴量重要度（baseline_tactical）

| 順位 | 特徴量 | 重要度 | カテゴリ |
|------|--------|--------|----------|
| 1 | red_placement_score | 0.676 | 戦術スコア |
| 2 | blue_placement_score | 0.366 | 戦術スコア |
| 3 | red_dragons | 0.276 | オブジェクト |
| 4 | red_total_cs | 0.261 | CS |
| 5 | blue_deny_score | 0.259 | 戦術スコア |
| 6 | blue_dragons | 0.245 | オブジェクト |
| 7 | kill_diff | 0.182 | キル |
| 8 | red_kills | 0.164 | キル |
| 9 | placement_score_diff | 0.124 | 戦術スコア |
| 10 | red_towers | 0.123 | オブジェクト |

**分析**: 10分時点では戦術スコア特徴量（placement_score、deny_score）がトップ5のうち3つを占め、モデルの主要な予測因子となっています。

#### 特徴量重要度（baseline、参考）

| 順位 | 特徴量 | 重要度 |
|------|--------|--------|
| 1 | red_dragons | 0.370 |
| 2 | blue_dragons | 0.264 |
| 3 | red_total_cs | 0.177 |
| 4 | red_towers | 0.175 |
| 5 | kill_diff | 0.153 |

### 4.2 20分時点

#### モデル性能比較

| モデル | Accuracy | AUC | LogLoss | 特徴量数 |
|--------|----------|-----|---------|----------|
| baseline | 80.43% | 0.901 | 0.401 | 20 |
| baseline_riot | 84.78% | 0.907 | 0.386 | 23 |
| baseline_grid | 80.43% | 0.884 | 0.420 | 26 |
| **baseline_tactical** | **88.04%** | **0.945** | **0.320** | 26 |

#### ベースラインからの改善度

| モデル | Accuracy改善 | AUC改善 | 相対貢献度 |
|--------|-------------|---------|------------|
| baseline_riot | +4.35 pt | +0.006 | 22.22% |
| baseline_grid | +0.00 pt | -0.017 | 0.00% |
| **baseline_tactical** | **+7.61 pt** | **+0.044** | **38.89%** |

#### 特徴量重要度（baseline_tactical）

| 順位 | 特徴量 | 重要度 | カテゴリ |
|------|--------|--------|----------|
| 1 | red_placement_score | 0.592 | 戦術スコア |
| 2 | blue_placement_score | 0.412 | 戦術スコア |
| 3 | blue_avg_level | 0.295 | レベル |
| 4 | red_avg_level | 0.282 | レベル |
| 5 | red_total_gold | 0.246 | ゴールド |
| 6 | blue_total_xp | 0.239 | 経験値 |
| 7 | red_kills | 0.239 | キル |
| 8 | kill_diff | 0.194 | キル |
| 9 | red_total_xp | 0.188 | 経験値 |
| 10 | red_dragons | 0.186 | オブジェクト |

**分析**: 20分時点でも戦術スコア特徴量がトップ2を占めますが、レベル・ゴールド・経験値など従来の指標の重要度も高くなっています。

#### 特徴量重要度（baseline、参考）

| 順位 | 特徴量 | 重要度 |
|------|--------|--------|
| 1 | blue_avg_level | 0.323 |
| 2 | red_avg_level | 0.304 |
| 3 | red_total_gold | 0.303 |
| 4 | red_dragons | 0.238 |
| 5 | blue_total_xp | 0.237 |

---

## 5. 時間帯別分析

### 5.1 ベースライン精度の推移

| 時点 | Accuracy | AUC | LogLoss |
|------|----------|-----|---------|
| 10分 | 59.78% | 0.648 | 0.666 |
| 20分 | 80.43% | 0.901 | 0.401 |
| **改善幅** | +20.65 pt | +0.253 | -0.265 |

**解釈**: 試合時間が経過するほどゴールド差・オブジェクト差が蓄積し、勝敗の予測が容易になります。

### 5.2 視界スコアの貢献度推移

| モデル | 10分 Accuracy改善 | 20分 Accuracy改善 | 効果の変化 |
|--------|-------------------|-------------------|------------|
| baseline_riot | +8.70 pt | +4.35 pt | -4.35 pt |
| baseline_tactical | +17.39 pt | +7.61 pt | -9.78 pt |

**解釈**: 序盤（10分時点）ほど視界スコアの効果が顕著です。これは以下の理由が考えられます：

1. **序盤はゴールド差が小さい**: 従来の指標では差がつきにくいため、視界の質が予測力を持つ
2. **序盤のward配置は戦略的意図を反映**: 良いプレイヤーほど有効な位置にwardを設置する傾向
3. **20分時点では経済差が支配的**: ゴールド・経験値・オブジェクトの差が勝敗に直結する

---

## 6. モデル間比較分析

### 6.1 Riot visionScore vs 戦術スコア

| 観点 | Riot visionScore | 戦術スコア |
|------|------------------|------------|
| **10分時点精度向上** | +8.70 pt | **+17.39 pt** |
| **20分時点精度向上** | +4.35 pt | **+7.61 pt** |
| **AUC向上（10分）** | +0.062 | **+0.178** |
| **AUC向上（20分）** | +0.006 | **+0.044** |
| **特徴量数** | 3個 | 6個 |
| **計算方法** | Riot社非公開アルゴリズム | ヒートマップ重要度 |

**結論**: 戦術スコアはRiot visionScoreの約2倍の精度向上効果を示しました。

### 6.2 wardグリッド統計量 vs 戦術スコア

| 観点 | wardグリッド | 戦術スコア |
|------|--------------|------------|
| **10分時点精度向上** | +0.00 pt | **+17.39 pt** |
| **20分時点精度向上** | +0.00 pt | **+7.61 pt** |
| **AUC変化（10分）** | +0.000 | **+0.178** |
| **AUC変化（20分）** | -0.017 | **+0.044** |

**結論**: 単純なwardグリッド統計量は予測精度を向上させませんでした。位置の「戦術的価値」を考慮することが重要です。

### 6.3 wardグリッド特徴量が効かなかった理由

1. **情報の冗長性**: ベースラインに既に`wards_placed`（設置数）が含まれる
2. **文脈の欠落**: 「どこに置いたか」だけでは不十分、「どれだけ良い位置か」が必要
3. **次元の呪い**: 92試合では高次元特徴量の学習が困難
4. **ノイズの増加**: 無関係な位置情報がノイズとなりLogLossが悪化

---

## 7. 戦術スコアの有効性分析

### 7.1 なぜ戦術スコアは効果的か

| 要因 | 説明 |
|------|------|
| **位置の価値を定量化** | 全てのwardを同等に扱わず、戦術的に重要な位置を高評価 |
| **勝敗との相関を学習** | ヒートマップから「勝利に寄与するward配置」を事前学習 |
| **低次元で効率的** | 6特徴量のみで高い予測力を実現 |
| **両チームの評価** | 設置スコアと破壊スコアで攻防両面を評価 |

### 7.2 戦術スコア特徴量の重要度分布

| 特徴量 | 10分重要度 | 20分重要度 | 変化 |
|--------|------------|------------|------|
| red_placement_score | 0.676 | 0.592 | -0.084 |
| blue_placement_score | 0.366 | 0.412 | +0.046 |
| blue_deny_score | 0.259 | - | - |
| placement_score_diff | 0.124 | - | - |

**分析**:
- `placement_score`（設置スコア）が最も重要
- Redチームの設置スコアがBlueより高重要度（位置の非対称性を反映）
- 破壊スコア（deny_score）は10分時点で効果的

---

## 8. 予測信頼度分析

### 8.1 予測確率の分布（baseline_tactical、10分時点）

サンプル予測確率の統計:
- 最小値: 0.027
- 最大値: 0.964
- 平均値: 0.476
- 標準偏差: 0.238

**高信頼度予測の例**:
- 試合21: 予測確率 0.035 → Red勝利（正解）
- 試合72: 予測確率 0.964 → Blue勝利（正解）

### 8.2 予測確率の分布（baseline_tactical、20分時点）

- 最小値: 0.005
- 最大値: 0.994
- 平均値: 0.470
- 標準偏差: 0.307

**分析**: 20分時点では予測確率の標準偏差が大きくなり、より確信度の高い予測が可能になっています。

---

## 9. 結論

### 9.1 主要な発見

1. **戦術スコアは最も高い予測精度を達成**
   - 10分時点: 77.17%（ベースライン比 +17.39 pt）
   - 20分時点: 88.04%（ベースライン比 +7.61 pt）

2. **Riot visionScoreを上回る性能**
   - 10分時点で約2倍の精度向上効果
   - 位置の戦術的価値を考慮することの重要性を確認

3. **序盤ほど視界スコアの効果が大きい**
   - 経済差が小さい序盤では視界の質が勝敗に寄与
   - 20分以降は従来の経済指標が支配的

4. **単純なwardグリッド特徴量は無効**
   - 「どこに置いたか」の生情報ではなく「どれだけ良い位置か」の評価が必要

### 9.2 最終モデル性能

| 評価時点 | 最良モデル | Accuracy | AUC |
|----------|------------|----------|-----|
| 10分 | baseline_tactical | **77.17%** | **0.826** |
| 20分 | baseline_tactical | **88.04%** | **0.945** |

### 9.3 仮説の検証結果

> 「ward座標を特徴量として組み込むことで予測精度が向上する」

**採択**: 戦術スコア化により+17.39%（10分時点）の精度向上を達成しました。
ただし、単純な座標情報ではなく、ヒートマップ重要度で重み付けした「戦術的価値」として定量化することが必要でした。

---

## 10. 制約事項と今後の課題

### 10.1 制約事項

1. **サンプルサイズ**: 92試合は統計的に十分とは言えない
2. **visionScore推定値**: 途中時点のRiot visionScoreは推定値であり正確ではない
3. **サーバー・ティア依存**: JPサーバー・Diamond帯のみで検証
4. **パッチ依存**: パッチ25.S1.2のメタに依存

### 10.2 今後の課題

| 課題 | 内容 |
|------|------|
| データ拡張 | 100試合→数百試合での検証 |
| 時間帯別最適化 | 5分刻みのヒートマップを活用 |
| 破壊スコアの強化 | ward破壊の戦術的価値をより精密に評価 |
| チャンピオン座標統合 | 視界が「何を捉えたか」を評価可能に |
| 他モデルの検討 | LightGBM、XGBoostなどの試行 |

---

## 11. 生成ファイル一覧

| ファイル | パス | 説明 |
|----------|------|------|
| データセット | `data/prediction_dataset.npz` | 学習用特徴量・ラベル |
| 学習済みモデル | `models/*_10min.joblib`、`models/*_20min.joblib` | 各モデル |
| 比較結果JSON | `results/model_comparison.json` | 詳細な評価結果 |
| 比較グラフ | `results/model_comparison.png` | Accuracy/AUC比較 |
| 特徴量重要度 | `results/feature_importance_10min.png` | 10分時点 |
| | `results/feature_importance_20min.png` | 20分時点 |
| 戦術スコア評価 | `results/tactical_score_evaluation.json` | 戦術スコアモデル詳細 |

---

## 付録: 評価手法の詳細

### Leave-One-Out Cross Validation (LOO-CV)

- 各試合を1つずつテストデータとし、残り91試合で学習
- 92回の評価を実施し、平均精度を算出
- 小規模データセットで有効な評価手法

### 評価指標

| 指標 | 説明 |
|------|------|
| Accuracy | 正解率（正しく予測した試合の割合） |
| AUC | ROC曲線下面積（識別能力の指標、0.5=ランダム、1.0=完全） |
| LogLoss | 対数損失（予測確率のキャリブレーション、小さいほど良い） |
